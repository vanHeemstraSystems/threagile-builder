{% extends 'base.html' %} {% block content %}

<section class="bg-white dark:bg-gray-900">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Edit Build</h1>

        <form method="POST" class="bg-white shadow-md rounded-lg p-6">
            {{ form.hidden_tag() }}
            <div class="mb-4">
                {{ form.title.label(class="block text-gray-700") }}
                {{ form.title(class="mt-1 block w-full p-2 border rounded") }}
            </div>
            <div class="mb-4">
                {{ form.description.label(class="block text-gray-700") }}
                {{ form.description(class="mt-1 block w-full p-2 border rounded") }}
            </div>
            <div class="mb-4">
                {{ form.code.label(class="block text-gray-700") }}
                {{ form.code(class="mt-1 block w-full p-2 border rounded") }}
            </div>
            {{ form.submit(class="bg-blue-500 text-white rounded py-2 px-4") }}
        </form>

        <!-- START Blockly Editor -->

        <div style="width: 900px; margin: 0 auto" id="example-frame">
            <div class="btn-group" data-toggle="buttons" data-bind="visible: !assignment.upload()">
                <label onclick="editor.setMode('block');">
                    <input type="radio" name="blockpy-mode-set" autocomplete="off" />
                    Blocks
                </label>
                <label onclick="editor.setMode('split');">
                    <input type="radio" name="blockpy-mode-set" autocomplete="off" checked />
                    Split
                </label>
                <label onclick="editor.setMode('text');">
                    <input type="radio" name="blockpy-mode-set" autocomplete="off" /> Text
                </label>
            </div>
            <div id="blockmirror-editor"></div>
        </div>
        <!-- example-frame -->

        <!-- END Blockly Editor -->
    </div>

    <script type="text/javascript">
        console.log('BlockMirror Editor started');
        var editor = new BlockMirror({
            container: document.getElementById('blockmirror-editor'),
            blocklyMediaPath: '../../static/lib/blockly/media/',
            skipSkulpt: true,
            codeMirrorMode: 'yaml',
            toolbox: 'full',
            // 'empty', 'threagile'
        });
        editor.addChangeListener(function (event) {
            console.log('Change! Better save:', event);
            // console.debug(document.getElementById('code').innerText);
        });
        editor.setCode('threagile_version: 1.0.0'); // 'class X:\n    return\n    threagile_version: 1.0.0'
//         /* Blockly Block Definition
//          * Set up the Blockly block in your JavaScript code.
//          */
//         Blockly.Blocks['author_info'] = {
//             init: function () {
//                 this.appendDummyInput()
//                     .appendField("Author Name")
//                     .appendField(new Blockly.FieldTextInput("John Doe"), "name");
//                 this.appendDummyInput()
//                     .appendField("Homepage")
//                     .appendField(new Blockly.FieldTextInput("https://example.com"), "homepage");
//                 this.setColour(160);
//                 this.setTooltip("Author information in YAML format");
//                 this.setHelpUrl("");
//             }
//         };
//         /* Generate YAML from Blockly
//          * Create a function to generate the YAML representation from the Blockly block.
//          */
//         function generateYAMLFromBlockly() {
//             const block = Blockly.getMainWorkspace().getBlockById('author_info_block'); // Use actual block ID
//             const name = block.getFieldValue('name');
//             const homepage = block.getFieldValue('homepage');

//             // Construct YAML string
//             const yamlOutput = `
// author:
//   name: ${name}
//   homepage: ${homepage}
// `.trim();

//             return yamlOutput;
//         }

//         /* Update CodeMirror
//          * Insert the generated YAML code into the CodeMirror editor.
//          */
//         function updateCodeMirror() {
//             const yamlOutput = generateYAMLFromBlockly();
//             editor.setValue(yamlOutput);
//         }

//         // Call this function initially to set the value
//         updateCodeMirror();


    </script>

</section>

{% endblock %}